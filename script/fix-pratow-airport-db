#!/bin/ruby

input = open("/home/james/GlobalAirportDatabase.txt")
output = open("/home/james/GlobalAirportDatabaseFixed.txt", "w")
# For each line in the file
input.read.each { |line|
  # Split into data fields
  fields = line.split(':')
  # Create country-hemisphere mapping
  mapping = {    
    "ACORES" => "W",
    "ALGERIA" => "W",
    "ANGUILLA ISL." => "W",
    "ANTARCTICA" => "W",
    "ANTILLES" => "W",
    "ARGENTINA" => "W",
    "ARUBA" => "W",
    "BAHAMAS" => "W",
    "BARBADOS" => "W",
    "BELIZE" => "W",
    "BOLIVIA" => "W",
    "BRAZIL" => "W",
    "BURKINA FASO" => "W",
    "CANADA" => "W",
    "CANARY ISLANDS" => "W",
    "CAPE VERDE ISLANDS" => "W",
    "CAYMAN ISLANDS" => "W",
    "CENTRAL AFRICAN REP." => "E",
    "CHILE" => "W",
    "COLOMBIA" => "W",
    "COOK ISLANDS" => "W",
    "COSTA RICA" => "W",
    "CUBA" => "W",
    "DOMINICA" => "W",
    "DOMINICAN REPUBLIC" => "W",
    "ECUADOR" => "W",
    "EL SALVADOR" => "W",
    "ENGALND" => "W",
    "ENGLAND" => "W",
    "FALKLAND ISLANDS" => "W",
    "FAROE ISL." => "W",
    "FRANCE" => "W",
    "FRENCH GUYANA" => "W",
    "FRENCH POLYNESIA" => "W",
    "GALAPAGOS I. (ECUADOR" => "W",
    "GAMBIA" => "W",
    "GERMANY" => "E",
    "GHANA" => "W",
    "GIBRALTAR" => "W",
    "GREENLAND" => "W",
    "GRENADA" => "W",
    "GUATEMALA" => "W",
    "GUERNSEY ISLD." => "W",
    "GUINEA" => "W",
    "GUINEA BISSAU" => "W",
    "GUYANA" => "W",
    "HAITI" => "W",
    "HONDURAS" => "W",
    "ICELAND" => "W",
    "IRELAND" => "W",
    "IVORY COAST" => "W",
    "JAMAICA" => "W",
    "JOHNSTON ATOLL" => "W",
    "KIRIBATI" => "W",
    "LEEWARD ISLANDS" => "W",
    "LIBERIA" => "W",
    "MADEIRA" => "W",
    "MALAWI" => "E",
    "MALI" => "W",
    "MAURITANIA" => "W",
    "MEXICO" => "W",
    "MIDWAY ISLAND" => "W",
    "MONTSERRAT ISLAND" => "W",
    "MOROCCO" => "W",
    "NEW ZEALAND" => "E",
    "NICARAGUA" => "W",
    "NORTH IRELAND" => "W",
    "PANAMA" => "W",
    "PARAGUAY" => "W",
    "PERU" => "W",
    "PORTUGAL" => "W",
    "PUERTO RICO" => "W",
    "RUSSIA" => "W",
    "SAMOA" => "W",
    "SCOTLAND" => "W",
    "SENEGAL" => "W",
    "SIERRA LEONE" => "W",
    "SPAIN" => "W",
    "SPANISH NORTH AFRICA" => "E",
    "ST. KITTS & NEVIS" => "W",
    "ST. LUCIA ISLAND" => "W",
    "ST. PIERRE & MIQUELON" => "W",
    "ST.VINCENT/GRENADINES" => "W",
    "SURINAM" => "W",
    "TONGA" => "W",
    "TRINIDAD & TOBAGO" => "W",
    "TUAMOTU ISLANDS" => "W",
    "TURKS & CAICOS I." => "W",
    "U.K" => "W",
    "U.K." => "W",
    "URUGUAY" => "W",
    "USA" => "W",
    "USA (FLORIDA" => "W",
    "USA  HAWAII ISL." => "W",
    "USA  KAUAI ISL." => "W",
    "USA  LANAI ISL." => "W",
    "USA  MAUI ISL." => "W",
    "USA  MOLOKAI ISL." => "W",
    "USA  OAHU ISL." => "W",
    "VENEZUELA" => "W",
    "VIRGIN ISL." => "W",
    "WALES" => "W",
    "WALLIS & FUTUNA" => "E",
  }
  # If the longitude direction is unknown  
  if fields[12] == "U" and (fields[11].to_i != 0 or fields[10].to_i != 0 or fields[9].to_i != 0)
    # Print country
    unless mapping[fields[4]].nil?
      fields[12] = mapping[fields[4]]
    else
      puts fields.join(':')
    end
  end
  output.write(fields.join(':'))
}
